---
- hosts: localhost
  gather_facts: false

  tasks:
  - name: Collect the list of the existing VM
    vmware.vmware_rest.vcenter_vm_info:
    register: existing_vms
    until: existing_vms is not failed

  - debug:
         var: existing_vms

  - name: "Find folder"
    community.vmware.vmware_guest_find:
        validate_certs: false
        name: "{{ item.name }}"
    register: vm_facts
    loop: "{{ vm_facts.value }}"

  - debug:
         var: vm_facts
