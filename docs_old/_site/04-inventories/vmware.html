<h1 id="inventory-configuration-for-vmware">Inventory configuration for VMware</h1>

<h2 id="base-configuration">Base configuration</h2>
<ol>
  <li>Click <code class="highlighter-rouge">Resources</code> -&gt; <code class="highlighter-rouge">Inventories</code></li>
  <li>Click <code class="highlighter-rouge">Add</code> -&gt; <code class="highlighter-rouge">Add inventory</code></li>
  <li>Enter the following parameters
    <ul>
      <li><strong>Name</strong>: <code class="highlighter-rouge">SAP Demo</code></li>
      <li><strong>Organization</strong>: <em><code class="highlighter-rouge">Your Organization</code></em></li>
    </ul>
  </li>
  <li>
    <p>Add the following variables:</p>

    <p>```yaml
# These variables are valid for all hosts in the VMware environment
vcenter_validate_certs: no  ## if you use a self signed certificate
vmware_cluster: <em>Name of VMware Cluster</em>
vmware_datacenter: <em>Name of VMware Datacenter</em>
vmware_datastore: <em>Name of VMware Datastore</em>
vmware_folder: <em>Name of folder for the VMs</em>
vmware_template: Name of the VMware template to clone from (has to be in the VMware datastore for the module to work)
vmware_network: <em>VMware Network Name</em></p>

    <h1 id="nfs-share-with-installation-software">NFS Share with installation Software</h1>
    <p>nfs_software_archive_srv: 1.2.3.4:/SapInst  # NFS Server with SAP Software
nfs_software_archive_dir: /sapinst  # local mountpoint
```</p>

    <p>This demo assumes that you have downloaded the SAP software installation bundles to a fileserver that can be accessed via NFS from the nodes. 
As the fileserver is used by all host in the inventory you can define it here</p>
  </li>
  <li>Click <code class="highlighter-rouge">Save</code></li>
</ol>

<p>If you do not know the name of cluster, datacenter, datastore, folder now, just enter a dummy name and continue.
In the next sections we define some templates to figure out these names.</p>

<h2 id="configure-dynamic-inventories">Configure dynamic inventories</h2>

<p>In the just created inventory click on:
1. Click on <code class="highlighter-rouge">Sources</code>
2. Click <code class="highlighter-rouge">Add</code>
3. Enter the following:
   - <strong>Name</strong>: SAP Server
   - <strong>Source</strong>: VMware vCenter
   - <strong>Credential</strong>: <em>your VCenter Credential</em>
   - <strong>Host Filter</strong>: <code class="highlighter-rouge">sapdemo.*</code> - I recommend adding a unique prefix to your servers, e.g. sapdemo, in case there are more servers on the environment, and you only want to pick the demo servers<br />
   - <strong>Update Options</strong>: overwrite
   - <strong>Source Variables</strong>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  ```yaml
  ---
  with_path: false
  properties:
  - "name"
  - "config.hardware.numCPU"
  - "config.name"
  - "config.uuid"
  - "guest.ipAddress"
  - "runtime.maxMemoryUsage"
  - "guest.guestId"
  - "config.annotation"
  hostnames:
  - config.name
  compose:
    ansible_host: 'guest.ipAddress'
  groups:
    sap: true
  keyed_groups:
  - key: config.annotation
    separator: ''
    ```  4. Click `Save`
</code></pre>
</div>

<p>With that configuration the hosts are added to the inventory with their names. They are reached through their ip addresses (ansible_host), They are all added to the group <code class="highlighter-rouge">sap</code> and to the group that is set in the annotation field of the VM. Tags may also be an option and if you set <code class="highlighter-rouge">with_path</code> to true the machines are grouped by their VMware path</p>

<p>The playbooks in this demo are written to use the annotation field for grouping. If you want or need to change that, please raise an issue in GitHub and make a suggestion.</p>

<blockquote>
  <p><strong>Question to reader</strong>: If you happen to know how to create tags to VMs when creating VMs with ansible, please leave a comment <a href="https://github.com/sap-linuxlab/demo.sap_install/issues/8">here</a></p>
</blockquote>
