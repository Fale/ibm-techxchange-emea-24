---
# Phase 3 - step B
#
# This playbook downloads the hana software defined
# in the list {{ sap_hana_software }} to {{ sap_hana_install_software_directory }}
#
# The role sap_hana_install unpacks the software in {{ sap_hana_install_software_directory }}
# Then it calls the installation of SAP HANA with the configured paramters

- name: Phase 3-B - Install Hana
  hosts: rha-nfs-server
  become: true

  tasks:

          # - name: include GCSFUSE
          # include_role:
          # name: google.cloud.gcsfuse
    - name: prerequisites
      pip:
        name: google-cloud-storage
        state: present

    - name: copy sarfiles from bucket locally
      google.cloud.gcp_storage_object:
        action: download
        bucket: "rh-ava-packages"
        src: "sap/{{ item }}"
        dest: "{{ sap_hana_install_software_directory }}"
        auth_kind: serviceaccount
      loop: "{{ sap_hana_install_sarfiles }}"

    # name: execute the SAP Hana Installation
    # include_role:
    #   name: community.sap_install.sap_hana_install
