---
# call playbook with # ansible-playbook example_in_one_file.yml
- name: "Phase 03-C and 03-D -Setup HANA System Replication"
  hosts: hanas
  become: true

#  vars:
#    sap_domain: example.com
#
#    sap_hana_sid: 'DB1'
#    sap_hana_instance_number: '00'
#    sap_hana_install_master_password: 'my_hana_password'
#    # It is recommended to use vault instead of plain text passwords. Example please check README
#
#    ### Cluster Definition
#    sap_ha_install_pacemaker_cluster_name: cluster1
#    sap_hana_hacluster_password: 'my_hacluster'
#
#    sap_hana_cluster_nodes:
#      - node_name: hana1
#        node_ip: 10.0.0.101
#        node_role: primary
#        hana_site: DC01
#
#      - node_name: hana2
#        node_ip: 10.0.0.102
#        node_role: secondary
#        hana_site: DC02
#
#    sap_ha_set_hana_vip1: 10.0.0.200
#
## To be changed for power
# pcs stonith describe fence_openstack
#    sap_pacemaker_stonith_devices:
#      - name: "fence_name_for_vmware"
#        agent: "fence_vmware_rest"
#        parameters: >
#           "pcmk_host_list='rhd-hana1,rhd-hana2' ssl_insecure=1 ssl=1
#           "ipaddr={{ lookup('env', 'VMWARE_HOST')}}"
#           "login={{lookup('env','VMWARE_USER')}}"
#           "passwd={{lookup('env','VMWARE_PASSWORD')}}"
#

# Access the IP Address of a particular hostname:
# hostvars[inventory_hostname].ansible_host
#
  pre_tasks:
    - name: Copy pre-release fence_openstack
      copy:
        src: usr/sbin/fence_openstack
        dest: /usr/sbin/fence_openstack
        owner: root
        group: root
        mode: 0755

  roles:
    - community.sap_install.sap_ha_install_hana_hsr
    - community.sap_install.sap_ha_prepare_pacemaker
    - community.sap_install.sap_ha_install_pacemaker
    - community.sap_install.sap_ha_set_hana
